From f1ca0156e9ef39a020456a276060df4a98c1d1a2 Mon Sep 17 00:00:00 2001
From: user <user@domain.com>
Date: Mon, 16 Jun 2025 22:07:50 +0800
Subject: [PATCH] change spdlog with yr

---
 CMakeLists.txt                                | 409 ++++++++++++++----
 .../eSDKLogAPI/eSDKLog.cpp                    |  42 +-
 2 files changed, 342 insertions(+), 109 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 1b5f86a..4e91ca3 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,8 +1,17 @@
-cmake_minimum_required(VERSION 3.0)
+# Copyright (c) Huawei Technologies Co., Ltd. 2023-2023. All rights reserved.
+
+cmake_minimum_required(VERSION 3.16.1)
 cmake_policy(SET CMP0004 NEW)
- 
+
 project(huaweicloud-obs-c-sdk)
- 
+
+set(INSTALL_BIN_DIR "${CMAKE_INSTALL_PREFIX}/bin" CACHE PATH "Installation directory for executables")
+set(INSTALL_LIB_DIR "${CMAKE_INSTALL_PREFIX}/lib" CACHE PATH "Installation directory for libraries")
+set(INSTALL_INC_DIR "${CMAKE_INSTALL_PREFIX}/include" CACHE PATH "Installation directory for headers")
+
+set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS} -s -fPIE -fPIC -fstack-protector-all -D_FORTIFY_SOURCE=2 -O2 -Wl,-z,relro,-z,noexecstack,-z,now,--build-id=none -fuse-ld=gold -DNDEBUG")
+set(CMAKE_C_FLAGS_RELEASE "${CMAKE_C_FLAGS} -Wl,-z,relro -Wl,-z,now -Wl,-z,noexecstack -s -fuse-ld=gold -D_FORTIFY_SOURCE=2 -O2 -DNDEBUG")
+
 #***********************************************************************
 #*
 #*  basic definitions
@@ -25,7 +34,7 @@ if(NOT CMAKE_HOST_WIN32)
 endif()
 
 option(USE_CUSTOM "option for custom library path" OFF)
-set(SECUREC_INC_DIR ${PROJECT_SOURCE_DIR}/platform/huaweisecurec/include)
+set(SECUREC_INC_DIR ${securec_ROOT}/include)
 set(CURL_VERSION curl-7.78.0)
 set(OPENSSL_VERSION openssl-1.1.1k)
 set(LIBXML2_VERSION libxml2-2.9.9)
@@ -33,83 +42,81 @@ set(PCRE_VERSION pcre-8.45)
 set(ICONV_VERSION iconv-1.15)
 set(CJSON_VERSION cjson-1.7.15)
 
-
-
 execute_process(COMMAND uname -m OUTPUT_VARIABLE OARCH)
-    string(STRIP "${OARCH}" ARCH)
-    message(">>> ARCH ${ARCH}")
-    if (${ARCH} STREQUAL "aarch64")
-        set(ESDK_LOG_INC_DIR ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10)
-        set(ESDK_LOG_LIB_DIR ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10/C/aarch64)
-        set(LINKARCH "arm")
-        #execute_process(COMMAND make -f  ${PROJECT_SOURCE_DIR}/platform/huaweisecurec/src/Makefile.aarch64)
-    elseif(${ARCH} STREQUAL "x86_64")
-        set(ESDK_LOG_INC_DIR ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10)
-        set(ESDK_LOG_LIB_DIR ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10/C/linux_64)
-        set(LINKARCH "linux")
-        #execute_process(COMMAND make -f  ${PROJECT_SOURCE_DIR}/platform/huaweisecurec/src/Makefile)
-    endif()
+string(STRIP "${OARCH}" ARCH)
+message(">>> ARCH ${ARCH}")
+if (${ARCH} STREQUAL "aarch64")
+    set(ESDK_LOG_INC_DIR ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10)
+    set(ESDK_LOG_LIB_DIR ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10/C/aarch64)
+    set(LINKARCH "arm")
+elseif(${ARCH} STREQUAL "x86_64")
+    set(ESDK_LOG_INC_DIR ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10)
+    set(ESDK_LOG_LIB_DIR ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10/C/linux_64)
+    set(LINKARCH "linux")
+endif()
 
-    if(NOT USE_CUSTOM)
-        set(CURL_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${CURL_VERSION}/include)
-        set(CURL_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${CURL_VERSION}/lib)
-        set(OPENSSL_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${OPENSSL_VERSION}/include)
-        set(OPENSSL_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${OPENSSL_VERSION}/lib)
-        set(LIBXML2_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${LIBXML2_VERSION}/include)
-        set(LIBXML2_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${LIBXML2_VERSION}/lib)
-        set(PCRE_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${PCRE_VERSION}/include/pcre)
-        set(PCRE_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${PCRE_VERSION}/lib)
-        set(ICONV_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${ICONV_VERSION}/include)
-        set(ICONV_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${ICONV_VERSION}/lib)
-        set(CJSON_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${CJSON_VERSION}/include)
-        set(CJSON_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${CJSON_VERSION}/lib)
-        set(SPDLOG_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${SPDLOG_VERSION}/include)
-        set(SPDLOG_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${SPDLOG_VERSION}/lib)
-	set(SECUREC_LIB_DIR ${PROJECT_SOURCE_DIR}/platform/huaweisecurec/lib/${LINKARCH})
-    else()
-        if(NOT DEFINED CURL_INC_DIR)
-            set(CURL_INC_DIR "/usr/include" CACHE STRING "")
-        endif()
-        if(NOT DEFINED CURL_LIB_DIR)
-            set(CURL_LIB_DIR "/usr/lib64" CACHE STRING "")
-        endif()
-        if(NOT DEFINED OPENSSL_INC_DIR)
-            set(OPENSSL_INC_DIR "/usr/include" CACHE STRING "")
-        endif()
-        if(NOT DEFINED OPENSSL_LIB_DIR)
-            set(OPENSSL_LIB_DIR "/usr/lib64" CACHE STRING "")
-        endif()
-        if(NOT DEFINED LIBXML2_INC_DIR)
-            set(LIBXML2_INC_DIR "/usr/include/libxml2" CACHE STRING "")
-        endif()
-        if(NOT DEFINED LIBXML2_LIB_DIR)
-            set(LIBXML2_LIB_DIR "/usr/lib64" CACHE STRING "")
-        endif()
-        if(NOT DEFINED PCRE_INC_DIR)
-            set(PCRE_INC_DIR "/usr/include" CACHE STRING "")
-        endif()
-        if(NOT DEFINED PCRE_LIB_DIR)
-            set(PCRE_LIB_DIR "/usr/lib64" CACHE STRING "")
-        endif()
-        if(NOT DEFINED ICONV_INC_DIR)
-            set(ICONV_INC_DIR "/usr/include" CACHE STRING "")
-        endif()
-        if(NOT DEFINED ICONV_LIB_DIR)
-            set(ICONV_LIB_DIR "/usr/lib64" CACHE STRING "")
-        endif()
-        if(NOT DEFINED CJSON_INC_DIR)
-            set(ICONV_LIB_DIR "/usr/lib64" CACHE STRING "")
-        endif()
-        if(NOT DEFINED CJSON_LIB_DIR)
-            set(ICONV_LIB_DIR "/usr/lib64" CACHE STRING "")
-        endif()      
-        if(NOT DEFINED SPDLOG_INC_DIR)
-            set(SPDLOG_INC_DIR "/usr/lib64" CACHE STRING "")
-        endif()
-        if(NOT DEFINED SPDLOG_LIB_DIR)
-            set(SPDLOG_LIB_DIR "/usr/lib64" CACHE STRING "")
-        endif()         
+if(NOT USE_CUSTOM)
+    message(STATUS "use custom lib")
+    set(CURL_INC_DIR ${curl_ROOT}/include)
+    set(CURL_LIB_DIR ${curl_ROOT}/lib)
+    set(OPENSSL_INC_DIR ${openssl_ROOT}/include)
+    set(OPENSSL_LIB_DIR ${openssl_ROOT}/lib)
+    set(LIBXML2_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${LIBXML2_VERSION}/include)
+    set(LIBXML2_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${LIBXML2_VERSION}/lib)
+    set(PCRE_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${PCRE_VERSION}/include)
+    set(PCRE_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${PCRE_VERSION}/lib)
+    set(ICONV_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${ICONV_VERSION}/include)
+    set(ICONV_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${ICONV_VERSION}/lib)
+    set(SECUREC_LIB_DIR ${securec_ROOT}/lib)
+    set(CJSON_INC_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${CJSON_VERSION}/include)
+    set(CJSON_LIB_DIR ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/${CJSON_VERSION}/lib)
+    set(SPDLOG_INC_DIR ${spdlog_ROOT}/include)
+    set(SPDLOG_LIB_DIR ${spdlog_ROOT}/lib)
+else()
+    message(STATUS "use default lib")
+    if(NOT DEFINED CURL_INC_DIR)
+    set(CURL_INC_DIR "/usr/include" CACHE STRING "")
+    endif()
+    if(NOT DEFINED CURL_LIB_DIR)
+    set(CURL_LIB_DIR "/usr/lib64" CACHE STRING "")
+    endif()
+    if(NOT DEFINED OPENSSL_INC_DIR)
+    set(OPENSSL_INC_DIR "/usr/include" CACHE STRING "")
+    endif()
+    if(NOT DEFINED OPENSSL_LIB_DIR)
+    set(OPENSSL_LIB_DIR "/usr/lib64" CACHE STRING "")
+    endif()
+    if(NOT DEFINED LIBXML2_INC_DIR)
+    set(LIBXML2_INC_DIR "/usr/include/libxml2" CACHE STRING "")
+    endif()
+    if(NOT DEFINED LIBXML2_LIB_DIR)
+    set(LIBXML2_LIB_DIR "/usr/lib64" CACHE STRING "")
     endif()
+    if(NOT DEFINED PCRE_INC_DIR)
+    set(PCRE_INC_DIR "/usr/include" CACHE STRING "")
+    endif()
+    if(NOT DEFINED PCRE_LIB_DIR)
+    set(PCRE_LIB_DIR "/usr/lib64" CACHE STRING "")
+    endif()
+    if(NOT DEFINED ICONV_INC_DIR)
+    set(ICONV_INC_DIR "/usr/include" CACHE STRING "")
+    endif()
+    if(NOT DEFINED ICONV_LIB_DIR)
+    set(ICONV_LIB_DIR "/usr/lib64" CACHE STRING "")
+    endif()
+    if(NOT DEFINED CJSON_INC_DIR)
+    set(CJSON_INC_DIR "/usr/include/libxml2" CACHE STRING "")
+    endif()
+    if(NOT DEFINED CJSON_LIB_DIR)
+    set(CJSON_LIB_DIR "/usr/lib64" CACHE STRING "")
+    endif()
+    if(NOT DEFINED SPDLOG_INC_DIR)
+    set(SPDLOG_INC_DIR "/usr/lib64" CACHE STRING "")
+    endif()
+    if(NOT DEFINED SPDLOG_LIB_DIR)
+    set(SPDLOG_LIB_DIR "/usr/lib64" CACHE STRING "")
+    endif()   
+endif()
 
 message(STATUS "CURL_INC_DIR: ${CURL_INC_DIR}")
 message(STATUS "CURL_LIB_DIR: ${CURL_LIB_DIR}")
@@ -126,47 +133,247 @@ message(STATUS "CJSON_LIB_DIR: ${CJSON_LIB_DIR}")
 message(STATUS "SPDLOG_INC_DIR: ${SPDLOG_INC_DIR}")
 message(STATUS "SPDLOG_LIB_DIR: ${SPDLOG_LIB_DIR}")
 
+include_directories(${SECUREC_INC_DIR})
+link_directories(${SECUREC_LIB_DIR})
+
+# 获取 GCC 版本号
+execute_process(
+        COMMAND ${CMAKE_CXX_COMPILER} -dumpversion
+        OUTPUT_VARIABLE GCC_VERSION
+        OUTPUT_STRIP_TRAILING_WHITESPACE
+)
+
+message(STATUS "gcc version: ${GCC_VERSION}")
+
+message(STATUS "start build log4cpp")
+
+set(log4cpp_PATH ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10/log4cpp/)
+
+message(STATUS "log4cpp src path: ${log4cpp_SRC_PATH}")
+
+set(LOG4CPP_LIBRARY_NAME "log4cpp")
+
+INCLUDE_DIRECTORIES(${log4cpp_PATH}/include/)
+INCLUDE_DIRECTORIES(${log4cpp_PATH})
+ADD_LIBRARY(${LOG4CPP_LIBRARY_NAME} STATIC
+        ${log4cpp_PATH}/src/Appender.cpp
+        ${log4cpp_PATH}/src/AppenderSkeleton.cpp
+        ${log4cpp_PATH}/src/AppendersFactory.cpp
+        ${log4cpp_PATH}/src/BufferingAppender.cpp
+        ${log4cpp_PATH}/src/FactoryParams.cpp
+        ${log4cpp_PATH}/src/LayoutsFactory.cpp
+        ${log4cpp_PATH}/src/LevelEvaluator.cpp
+        ${log4cpp_PATH}/src/Localtime.cpp
+        ${log4cpp_PATH}/src/PassThroughLayout.cpp
+        ${log4cpp_PATH}/src/TriggeringEventEvaluatorFactory.cpp
+        ${log4cpp_PATH}/src/LayoutAppender.cpp
+        ${log4cpp_PATH}/src/FileAppender.cpp
+        ${log4cpp_PATH}/src/DailyRollingFileAppender.cpp
+        ${log4cpp_PATH}/src/RollingFileAppender.cpp
+        ${log4cpp_PATH}/src/FixedContextCategory.cpp
+        ${log4cpp_PATH}/src/IdsaAppender.cpp
+        ${log4cpp_PATH}/src/OstreamAppender.cpp
+        ${log4cpp_PATH}/src/StringQueueAppender.cpp
+        ${log4cpp_PATH}/src/SyslogAppender.cpp
+        ${log4cpp_PATH}/src/RemoteSyslogAppender.cpp
+        ${log4cpp_PATH}/src/SimpleLayout.cpp
+        ${log4cpp_PATH}/src/BasicLayout.cpp
+        ${log4cpp_PATH}/src/PatternLayout.cpp
+        ${log4cpp_PATH}/src/Category.cpp
+        ${log4cpp_PATH}/src/CategoryStream.cpp
+        ${log4cpp_PATH}/src/HierarchyMaintainer.cpp
+        ${log4cpp_PATH}/src/Configurator.cpp
+        ${log4cpp_PATH}/src/BasicConfigurator.cpp
+        ${log4cpp_PATH}/src/SimpleConfigurator.cpp
+        ${log4cpp_PATH}/src/PropertyConfigurator.cpp
+        ${log4cpp_PATH}/src/PropertyConfiguratorImpl.cpp
+        ${log4cpp_PATH}/src/LoggingEvent.cpp
+        ${log4cpp_PATH}/src/Priority.cpp
+        ${log4cpp_PATH}/src/NDC.cpp
+        ${log4cpp_PATH}/src/Filter.cpp
+        ${log4cpp_PATH}/src/TimeStamp.cpp
+        ${log4cpp_PATH}/src/StringUtil.cpp
+        ${log4cpp_PATH}/src/Properties.cpp
+        ${log4cpp_PATH}/src/Win32DebugAppender.cpp
+        ${log4cpp_PATH}/src/NTEventLogAppender.cpp
+        ${log4cpp_PATH}/src/DllMain.cpp
+        ${log4cpp_PATH}/src/DummyThreads.cpp
+        ${log4cpp_PATH}/src/MSThreads.cpp
+        ${log4cpp_PATH}/src/OmniThreads.cpp
+        ${log4cpp_PATH}/src/PThreads.cpp
+        ${log4cpp_PATH}/src/PortabilityImpl.cpp
+        ${log4cpp_PATH}/src/AbortAppender.cpp
+        )
+# 检查 GCC 版本号是否为 7.5
+if(GCC_VERSION MATCHES "7")
+    target_compile_options(${LOG4CPP_LIBRARY_NAME} PRIVATE -Wno-error=unused-variable -Wno-error=deprecated-declarations -Wno-error=dangling-else -Wno-error=format-nonliteral -Wno-error=parentheses -Wno-error=unused-result -Wno-error=unknown-pragmas)
+else()
+    target_compile_options(${LOG4CPP_LIBRARY_NAME} PRIVATE -Wno-error=unused-variable -Wno-error=deprecated-declarations -Wno-error=dangling-else -Wno-error=format-nonliteral -Wno-error=catch-value= -Wno-error=parentheses -Wno-error=unused-result -Wno-error=unknown-pragmas)
+endif()
+set_target_properties(${LOG4CPP_LIBRARY_NAME} PROPERTIES IMPORTED_LOCATION ${CMAKE_CURRENT_BINARY_DIR}/lib/liblog4cpp.so)
+
+message(STATUS "start build eSDKLogAPI")
+set(eSDKLogAPI_LIBRARY_NAME "eSDKLogAPI")
+
+set(eSDKLogAPI_PATH ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10/eSDKLogAPI/)
+set(vos_PATH ${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10/vos/)
+
+INCLUDE_DIRECTORIES(${eSDKLogAPI_PATH})
+INCLUDE_DIRECTORIES(${SECUREC_INC_DIR})
+INCLUDE_DIRECTORIES(${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10/)
+INCLUDE_DIRECTORIES(${PROJECT_SOURCE_DIR}/platform/eSDK_LogAPI_V2.1.10/vos/)
+
+file(GLOB eSDKLogAPI_SOURCES
+        "${eSDKLogAPI_PATH}/*.cpp"
+        "${vos_PATH}/*.cpp")
+
+add_library(${eSDKLogAPI_LIBRARY_NAME} SHARED
+        ${eSDKLogAPI_SOURCES})
+# 检查 GCC 版本号是否为 7.5
+if(GCC_VERSION MATCHES "7")
+    target_compile_options(${eSDKLogAPI_LIBRARY_NAME} PRIVATE -Wno-error=unused-variable -Wno-error=deprecated-declarations -Wno-error=dangling-else -Wno-error=format-nonliteral -Wno-error=parentheses -Wno-error=unused-result -Wno-error=unknown-pragmas)
+else()
+    target_compile_options(${eSDKLogAPI_LIBRARY_NAME} PRIVATE -Wno-error=unused-variable -Wno-error=deprecated-declarations -Wno-error=dangling-else -Wno-error=format-nonliteral -Wno-error=catch-value= -Wno-error=parentheses -Wno-error=unused-result -Wno-error=unknown-pragmas)
+endif()
+target_link_libraries(${eSDKLogAPI_LIBRARY_NAME} ${LOG4CPP_LIBRARY_NAME} securec pthread)
+##***********************************************************************
+##*
+##*  compile mode
+##*
+##***********************************************************************
+#SET(ESDK_BASE_FLAGS            "-g -Wall -fPIC -fno-strict-overflow")
+#SET(ESDK_SP_C_FLAGS            "-std=gnu99")
+#SET(ESDK_SP_C++_FLAGS          "-std=c++11")
+#SET(ESDK_SP_RELEASE_FLAGS      "-O2")
+#SET(ESDK_SP_DEBUG_FLAGS        "-O0 -coverage")
+#if(NOT CMAKE_HOST_WIN32)
+#    SET(SEC_REQ_FLAGS             "-fstack-protector-all -fPIE -pie -Wl,-z,relro,-z,now,-z,noexecstack")
+#    SET(SEC_SUG_BASE_FLAGS        "-Wformat=2")
+#    SET(SEC_SUG_SP_C_FLAGS        "-Wshadow -Wstack-protector")
+#endif()
+#
+#SET(ESDK_C_FLAGS     "${ESDK_BASE_FLAGS} ${ESDK_SP_C_FLAGS}")
+#SET(ESDK_C++_FLAGS   "${ESDK_BASE_FLAGS} ${ESDK_SP_C++_FLAGS}")
+#SET(SEC_C_FLAGS     "${SEC_REQ_FLAGS} ${SEC_SUG_BASE_FLAGS} ${SEC_SUG_SP_C_FLAGS}")
+#SET(SEC_C++_FLAGS   "${SEC_REQ_FLAGS} ${SEC_SUG_BASE_FLAGS}")
+#SET(CMAKE_SKIP_RPATH TRUE)
+#
+#if(CMAKE_BUILD_TYPE MATCHES "Release")
+#    message(">>> Release Mode")
+#    set(CMAKE_C_FLAGS     "${ESDK_C_FLAGS} ${ESDK_SP_RELEASE_FLAGS} ${SEC_C_FLAGS}")
+#    set(CMAKE_CXX_FLAGS "${ESDK_C++_FLAGS} ${ESDK_SP_RELEASE_FLAGS} ${SEC_C++_FLAGS}")
+#
+#else()
+#    message(">>> Debug Mode")
+#    set(CMAKE_C_FLAGS     "${ESDK_C_FLAGS} ${ESDK_SP_DEBUG_FLAGS} ${SEC_C_FLAGS}")
+#    set(CMAKE_CXX_FLAGS "${ESDK_C++_FLAGS} ${ESDK_SP_DEBUG_FLAGS} ${SEC_C++_FLAGS}")
+#    set(COVERAGE_LINK   "gcov")
+#    add_definitions(-D_DEBUG)
+#
+#endif()
+#
+#message(STATUS ">>> Source Dir: " ${PROJECT_SOURCE_DIR})
+#message(STATUS ">>> Binary Dir: " ${PROJECT_BINARY_DIR})
+#message(STATUS ">>> C_FLAGS   : " ${CMAKE_C_FLAGS})
+#message(STATUS ">>> CXX_FLAGS : " ${CMAKE_CXX_FLAGS})
+#
+##***********************************************************************
+##*
+##*  set dir of output binary and library
+##*
+##***********************************************************************
+#set(EXECUTABLE_OUTPUT_PATH    ${PROJECT_BINARY_DIR}/bin)
+#set(LIBRARY_OUTPUT_PATH       ${PROJECT_BINARY_DIR}/lib)
+#
+##***********************************************************************
+##*
+##*  Link lib
+##*
+##***********************************************************************
+#include_directories(${CURL_INC_DIR})
+#include_directories(${OPENSSL_INC_DIR})
+#include_directories(${LIBXML2_INC_DIR})
+#include_directories(${PCRE_INC_DIR})
+#include_directories(${ICONV_INC_DIR})
+#include_directories(${SECUREC_INC_DIR})
+#include_directories(${ESDK_LOG_INC_DIR})
+#include_directories(${CJSON_INC_DIR})
+#
+#
+#link_directories(${CURL_LIB_DIR})
+#link_directories(${OPENSSL_LIB_DIR})
+#link_directories(${LIBXML2_LIB_DIR})
+#link_directories(${PCRE_LIB_DIR})
+#link_directories(${ICONV_LIB_DIR})
+#link_directories(${SECUREC_LIB_DIR})
+#link_directories(${ESDK_LOG_LIB_DIR})
+#link_directories(${CJSON_LIB_DIR})
+#include_directories(${CMAKE_SOURCE_DIR}/source/eSDK_OBS_API/eSDK_OBS_API_C++/inc)
+#aux_source_directory(${CMAKE_SOURCE_DIR}/source/eSDK_OBS_API/eSDK_OBS_API_C++/src SOURCE_DIR)
+#add_library(eSDKOBS SHARED ${SOURCE_DIR})
+#target_link_libraries(eSDKOBS curl ssl xml2 pcre iconv securec ${eSDKLogAPI_LIBRARY_NAME})
+#
+##***********************************************************************
+##*
+##*  Unset Cache
+##*
+##***********************************************************************
+#unset(USE_CUSTOM CACHE)
+#unset(CURL_INC_DIR CACHE)
+#unset(CURL_LIB_DIR CACHE)
+#unset(OPENSSL_INC_DIR CACHE)
+#unset(OPENSSL_LIB_DIR CACHE)
+#unset(LIBXML2_INC_DIR CACHE)
+#unset(LIBXML2_LIB_DIR CACHE)
+#unset(PCRE_INC_DIR CACHE)
+#unset(PCRE_LIB_DIR CACHE)
+#unset(ICONV_INC_DIR CACHE)
+#unset(ICONV_LIB_DIR CACHE)
+#unset(CJSON_INC_DIR CACHE)
+#unset(CJSON_LIB_DIR CACHE)
+
+
 #***********************************************************************
 #*
 #*  compile mode
 #*
 #***********************************************************************
-SET(ESDK_BASE_FLAGS            "-g -Wall -fPIC -fno-strict-overflow -shared")
+SET(ESDK_BASE_FLAGS            "-g -Wall -fPIC -fno-strict-overflow -s -shared")
 SET(ESDK_SP_C_FLAGS            "-std=gnu99")
 SET(ESDK_SP_C++_FLAGS          "-std=c++11")
-SET(ESDK_SP_RELEASE_FLAGS      "-O2 -s")
+SET(ESDK_SP_RELEASE_FLAGS      "-O2")
 SET(ESDK_SP_DEBUG_FLAGS        "-O0 -coverage")
 if(NOT CMAKE_HOST_WIN32)
     SET(SEC_REQ_FLAGS             "-fstack-protector-strong -fPIE -pie -Wl,-z,relro,-z,now,-z,noexecstack")
     SET(SEC_SUG_BASE_FLAGS        "-Wformat=2")
     SET(SEC_SUG_SP_C_FLAGS        "-Wshadow -Wstack-protector")
 endif()
- 
+
 SET(ESDK_C_FLAGS     "${ESDK_BASE_FLAGS} ${ESDK_SP_C_FLAGS}")
 SET(ESDK_C++_FLAGS   "${ESDK_BASE_FLAGS} ${ESDK_SP_C++_FLAGS}")
 SET(SEC_C_FLAGS     "${SEC_REQ_FLAGS} ${SEC_SUG_BASE_FLAGS} ${SEC_SUG_SP_C_FLAGS}")
 SET(SEC_C++_FLAGS   "${SEC_REQ_FLAGS} ${SEC_SUG_BASE_FLAGS}")
 SET(CMAKE_SKIP_RPATH TRUE)
- 
+
 if(CMAKE_BUILD_TYPE MATCHES "Release")
     message(">>> Release Mode")
     set(CMAKE_C_FLAGS     "${ESDK_C_FLAGS} ${ESDK_SP_RELEASE_FLAGS} ${SEC_C_FLAGS}")
     set(CMAKE_CXX_FLAGS "${ESDK_C++_FLAGS} ${ESDK_SP_RELEASE_FLAGS} ${SEC_C++_FLAGS}")
- 
+
 else()
     message(">>> Debug Mode")
     set(CMAKE_C_FLAGS     "${ESDK_C_FLAGS} ${ESDK_SP_DEBUG_FLAGS} ${SEC_C_FLAGS}")
     set(CMAKE_CXX_FLAGS "${ESDK_C++_FLAGS} ${ESDK_SP_DEBUG_FLAGS} ${SEC_C++_FLAGS}")
     set(COVERAGE_LINK   "gcov")
     add_definitions(-D_DEBUG)
- 
+
 endif()
- 
+
 message(STATUS ">>> Source Dir: " ${PROJECT_SOURCE_DIR})
 message(STATUS ">>> Binary Dir: " ${PROJECT_BINARY_DIR})
 message(STATUS ">>> C_FLAGS   : " ${CMAKE_C_FLAGS})
 message(STATUS ">>> CXX_FLAGS : " ${CMAKE_CXX_FLAGS})
- 
+
 #***********************************************************************
 #*
 #*  set dir of output binary and library
@@ -174,7 +381,7 @@ message(STATUS ">>> CXX_FLAGS : " ${CMAKE_CXX_FLAGS})
 #***********************************************************************
 set(EXECUTABLE_OUTPUT_PATH    ${PROJECT_BINARY_DIR}/bin)
 set(LIBRARY_OUTPUT_PATH       ${PROJECT_BINARY_DIR}/lib)
- 
+
 #***********************************************************************
 #*
 #*  Link lib
@@ -233,4 +440,30 @@ unset(SPDLOG_LIB_DIR CACHE)
 #*  add source code dir
 #*
 #***********************************************************************
-#add_subdirectory(src)
\ No newline at end of file
+#add_subdirectory(src)
+
+#***********************************************************************
+#*
+#*  install
+#*
+#***********************************************************************
+install(TARGETS ${eSDKLogAPI_LIBRARY_NAME}
+    RUNTIME DESTINATION "${INSTALL_BIN_DIR}"
+    ARCHIVE DESTINATION "${INSTALL_LIB_DIR}"
+    LIBRARY DESTINATION "${INSTALL_LIB_DIR}")
+
+install(TARGETS eSDKOBS
+    RUNTIME DESTINATION "${INSTALL_BIN_DIR}"
+    ARCHIVE DESTINATION "${INSTALL_LIB_DIR}"
+    LIBRARY DESTINATION "${INSTALL_LIB_DIR}")
+
+install(FILES ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/iconv-1.15/lib/libiconv.so.2
+        DESTINATION ${INSTALL_LIB_DIR})
+install(FILES ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/libxml2-2.9.9/lib/libxml2.so.2
+        DESTINATION ${INSTALL_LIB_DIR})
+install(FILES ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/cjson-1.7.15/lib/libcjson.so.1
+        DESTINATION ${INSTALL_LIB_DIR})
+install(FILES ${PROJECT_SOURCE_DIR}/build/script/Provider/build/${LINKARCH}/pcre-8.45/lib/libpcre.so
+        DESTINATION ${INSTALL_LIB_DIR})
+
+file(COPY source/eSDK_OBS_API/eSDK_OBS_API_C++/inc/ DESTINATION ${INSTALL_INC_DIR} FILES_MATCHING PATTERN "*.h")
\ No newline at end of file
diff --git a/platform/eSDK_LogAPI_V2.1.10/eSDKLogAPI/eSDKLog.cpp b/platform/eSDK_LogAPI_V2.1.10/eSDKLogAPI/eSDKLog.cpp
index 0847954..6d93ee2 100644
--- a/platform/eSDK_LogAPI_V2.1.10/eSDKLogAPI/eSDKLog.cpp
+++ b/platform/eSDK_LogAPI_V2.1.10/eSDKLogAPI/eSDKLog.cpp
@@ -111,9 +111,9 @@ wchar_t *GetWcharFromChar(const char *char_str)
 }
 
 static std::mutex locker;
-static std::shared_ptr<spdlog::logger> runLogger;
-static std::shared_ptr<spdlog::logger> operationLogger;
-static std::shared_ptr<spdlog::logger> interfaceLogger;
+static std::shared_ptr<yr_spdlog::logger> runLogger;
+static std::shared_ptr<yr_spdlog::logger> operationLogger;
+static std::shared_ptr<yr_spdlog::logger> interfaceLogger;
 
 #ifdef WIN32
 bool eSDKLog::InitSPDLOG(const std::string& product, unsigned int logLevel[LOG_CATEGORY], const std::wstring& logPath, int mode) {
@@ -159,41 +159,41 @@ bool eSDKLog::InitSPDLOG(const std::string& product, unsigned int logLevel[LOG_C
 	}
 
 	try {
-		runLogger = spdlog::rotating_logger_mt(m_InstanceRunName, logPath + L"/" + instanceRunName_W + L".log"
+		runLogger = yr_spdlog::rotating_logger_mt(m_InstanceRunName, logPath + L"/" + instanceRunName_W + L".log"
 			, ConfigMgrInstance().GetLogSize_Run() * 1024, ConfigMgrInstance().GetLogNum_Run());
-		runLogger->set_level(spdlog::level::level_enum(spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Run()));
+		runLogger->set_level(yr_spdlog::level::level_enum(yr_spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Run()));
 		//设置日志格式为 时间（精确到毫秒） 线程号 日志名 日志级别 自定义信息
 		runLogger->set_pattern("[%Y-%m-%d %H:%M:%S.%e] [tid:%t] [%n] [%l] %v");
 		initiateSuccessfully = true;
 	}
-	catch (const spdlog::spdlog_ex &ex) {
+	catch (const yr_spdlog::spdlog_ex &ex) {
 		initiateSuccessfully = false;
 	}
 
 	if (initiateSuccessfully) {
 		try {
-			operationLogger = spdlog::rotating_logger_mt(m_InstanceOperationName, logPath + L"/" + instanceOperationName_W + L".log"
+			operationLogger = yr_spdlog::rotating_logger_mt(m_InstanceOperationName, logPath + L"/" + instanceOperationName_W + L".log"
 				, ConfigMgrInstance().GetLogSize_Run() * 1024, ConfigMgrInstance().GetLogNum_Run());
-			operationLogger->set_level(spdlog::level::level_enum(spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Operation()));
+			operationLogger->set_level(yr_spdlog::level::level_enum(yr_spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Operation()));
 			//设置日志格式为 时间（精确到毫秒） 线程号 日志名 日志级别 自定义信息
 			operationLogger->set_pattern("[%Y-%m-%d %H:%M:%S.%e] [tid:%t] [%n] [%l] %v");
 			initiateSuccessfully = true;
 		}
-		catch (const spdlog::spdlog_ex &ex) {
+		catch (const yr_spdlog::spdlog_ex &ex) {
 			initiateSuccessfully = false;
 		}
 	}
 
 	if (initiateSuccessfully) {
 		try {
-			interfaceLogger = spdlog::rotating_logger_mt(m_InstanceInterfaceName, logPath + L"/" + instanceInterfaceName_W + L".log"
+			interfaceLogger = yr_spdlog::rotating_logger_mt(m_InstanceInterfaceName, logPath + L"/" + instanceInterfaceName_W + L".log"
 				, ConfigMgrInstance().GetLogSize_Run() * 1024, ConfigMgrInstance().GetLogNum_Run());
-			interfaceLogger->set_level(spdlog::level::level_enum(spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Interface()));
+			interfaceLogger->set_level(yr_spdlog::level::level_enum(yr_spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Interface()));
 			//设置日志格式为 时间（精确到毫秒） 线程号 日志名 日志级别 自定义信息
 			interfaceLogger->set_pattern("[%Y-%m-%d %H:%M:%S.%e] [tid:%t] [%n] [%l] %v");
 			initiateSuccessfully = true;
 		}
-		catch (const spdlog::spdlog_ex &ex) {
+		catch (const yr_spdlog::spdlog_ex &ex) {
 			initiateSuccessfully = false;
 		}
 	}
@@ -212,41 +212,41 @@ bool eSDKLog::InitSPDLOG(const std::string& product, unsigned int logLevel[LOG_C
 	m_InstanceRunName = product + LOG_RUN_INSTANCE;
 
 	try {
-		runLogger = spdlog::rotating_logger_mt(m_InstanceRunName, logPath + "/" + m_InstanceRunName + ".log"
+		runLogger = yr_spdlog::rotating_logger_mt(m_InstanceRunName, logPath + "/" + m_InstanceRunName + ".log"
 			, ConfigMgrInstance().GetLogSize_Run() * 1024, ConfigMgrInstance().GetLogNum_Run());
-		runLogger->set_level(spdlog::level::level_enum(spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Run()));
+		runLogger->set_level(yr_spdlog::level::level_enum(yr_spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Run()));
 		//设置日志格式为 时间（精确到毫秒） 线程号 日志名 日志级别 自定义信息
 		runLogger->set_pattern("[%Y-%m-%d %H:%M:%S.%e] [tid:%t] [%n] [%l] %v");
 		initiateSuccessfully = true;
 	}
-	catch (const spdlog::spdlog_ex &ex) {
+	catch (const yr_spdlog::spdlog_ex &ex) {
 		initiateSuccessfully = false;
 	}
 
 	if (initiateSuccessfully) {
 		try {
-			operationLogger = spdlog::rotating_logger_mt(m_InstanceOperationName, logPath + "/" + m_InstanceOperationName + ".log"
+			operationLogger = yr_spdlog::rotating_logger_mt(m_InstanceOperationName, logPath + "/" + m_InstanceOperationName + ".log"
 				, ConfigMgrInstance().GetLogSize_Run() * 1024, ConfigMgrInstance().GetLogNum_Run());
-			operationLogger->set_level(spdlog::level::level_enum(spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Operation()));
+			operationLogger->set_level(yr_spdlog::level::level_enum(yr_spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Operation()));
 			//设置日志格式为 时间（精确到毫秒） 线程号 日志名 日志级别 自定义信息
 			operationLogger->set_pattern("[%Y-%m-%d %H:%M:%S.%e] [tid:%t] [%n] [%l] %v");
 			initiateSuccessfully = true;
 		}
-		catch (const spdlog::spdlog_ex &ex) {
+		catch (const yr_spdlog::spdlog_ex &ex) {
 			initiateSuccessfully = false;
 		}
 	}
 
 	if (initiateSuccessfully) {
 		try {
-			interfaceLogger = spdlog::rotating_logger_mt(m_InstanceInterfaceName, logPath + "/" + m_InstanceInterfaceName + ".log"
+			interfaceLogger = yr_spdlog::rotating_logger_mt(m_InstanceInterfaceName, logPath + "/" + m_InstanceInterfaceName + ".log"
 				, ConfigMgrInstance().GetLogSize_Run() * 1024, ConfigMgrInstance().GetLogNum_Run());
-			interfaceLogger->set_level(spdlog::level::level_enum(spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Interface()));
+			interfaceLogger->set_level(yr_spdlog::level::level_enum(yr_spdlog::level::debug + ConfigMgrInstance().GetLogLevel_Interface()));
 			//设置日志格式为 时间（精确到毫秒） 线程号 日志名 日志级别 自定义信息
 			interfaceLogger->set_pattern("[%Y-%m-%d %H:%M:%S.%e] [tid:%t] [%n] [%l] %v");
 			initiateSuccessfully = true;
 		}
-		catch (const spdlog::spdlog_ex &ex) {
+		catch (const yr_spdlog::spdlog_ex &ex) {
 			initiateSuccessfully = false;
 		}
 	}
-- 
2.33.0

